<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Medisol</title>

  <!-- Font Awesome Icons -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic' rel='stylesheet' type='text/css'>

  <!-- Plugin CSS -->
  <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

  <!-- Theme CSS - Includes Bootstrap -->
  <link href="css/creative.min.css" rel="stylesheet">


  <script>
    var map = null;
    var markerArray = [];
    function submit(){
            clear();
    var val = $("#id_one").val();
    var xhr = new XMLHttpRequest();
    xhr.open('POST', "http://127.0.0.1:8000", true);
    var data = new FormData();
    data.append("type", val);
    if(val != "cancer")
      {console.log("Here");
    data.append("img", $("#file_").prop('files')[0]);}
    xhr.onreadystatechange = function(){

      var obj = JSON.parse(this.responseText)[0];
      if(!obj["empty"])
      {
        $("prediction-id").html(obj["prediction"]);
        if(parseInt(obj["pred_val"]) != 0){
          plotMap(obj["places"]);
          addPlaces(obj["places"]);
        }
        $("#status").html("<b>"+obj["prediction"]+"</b>")
        $("#result").html("<b>"+obj["pred_val"]+"</b>")

      }
    };
    xhr.send(data);
  }
  function addPlaces(obj){  
    $.each(obj, function(index, obj_){
      console.log(obj_);
      $("#hospital").append("<div><b>"+obj_["name"]+"</b><br>"+obj_["address"]+"</div><br><br><br>");
    });
  }
  function initMap(){
      var  kolkata= {lat: 22.567627, lng: 88.347444};
  // The map, centered at Uluru
    map = new google.maps.Map(
      document.getElementById('map'), {zoom: 10, center: kolkata});
  }
  function clear()
  {
    for(var i=markerArray.length-1; i>=0; i--){
      markerArray[i].setMap(null);
      markerArray.pop();
    }
    $("#hospital").html("");
  }
  function plotMap(places){
    
    $.each(places, function(index,obj){
      if(map != null){
        markerArray.push(new google.maps.Marker({"position": obj["location"], map: map}));
      }
    });
  }
  </script>
  <script>
function show_hide_cancer(){
  if($("#id_one").val() == "cancer")
    {$("#myDIV").show();
    $("#file_").hide();}
    else{
      $("#myDIV").hide();
    $("#file_").show();
    }
}
</script>
<style>
.button {
  background-color: #4db8ff;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
.button1 {border-radius: 12px;}
</style>
</head>
<body id="page-top">

  <!-- Navigation -->


  <!-- Masthead -->
  <header class="masthead">
    <div class="container h-100">
      <div class="row h-100 align-items-center justify-content-center text-center">
        <div class="col-lg-10 align-self-end">
          <h1 class="text-uppercase text-white font-weight-bold">Deep Scan</h1>
          <hr class="divider my-4">
        </div>
        <div class="col-lg-8 align-self-baseline">
          <div id="status"> </div>
          <br>
          <div id="result"> </div>
        </div>

<center> 
<select id="id_one" onchange="show_hide_cancer()" class="button1 button">
  <option value="mal">Malaria</option>
  <option value="pnm">Chest Pnemonia</option>
  <option value="cancer">Cancer</option>
  <option value="None">None</option>
</select>
<br>
<br>
<br>
<div>
  <input id="file_" type="file" name="pic" accept="image/*" class="button button1">
  <br>
  <br>
<button onclick="submit()" class="button button1"> Analyse</button>
<br>
<br>
<br>
<div id="status"> </div>
<br>
<div id="result"> </div>
</center>


<br>
<div class="hospital" id="hospital"></div>
<div class="map" id="map"></div>

        </div>
      </div>
    </div>
  </header>

  

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
  <script src="vendor/magnific-popup/jquery.magnific-popup.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/creative.min.js"></script>

</body>

</html>
